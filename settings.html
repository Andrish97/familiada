<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="robots" content="noindex, nofollow"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="app-version" content="settings-2026.02.28.4"/>
  <title data-i18n="settings.title">Familiada ‚Äî settings</title>

  <link rel="icon" href="favicon.ico"/>
  <link rel="stylesheet" href="css/base.css"/>
  <link rel="stylesheet" href="css/builder.css"/>
  <link rel="stylesheet" href="css/settings.css?v=20260228-4"/>

  <script type="module" src="js/pages/settings.js?v=20260228-4" defer></script>
</head>
<body class="builder-body settings-body settings-locked no-footer-line">
  <header class="topbar topbar-layout-4 topbar-mobile-keep-brand">
    <div class="topbar-section topbar-section-1">
      <div class="brand">FAMILIADA</div>
    </div>
    <div class="topbar-section topbar-section-2">
      <a class="btn sm btn-external" id="btnSupabase" href="https://supabase.familiada.online" target="_blank" rel="noopener" data-i18n="settings.actions.supabase">Supabase</a>
      <a class="btn sm btn-external" id="btnServer" href="https://panel.familiada.online" target="_blank" rel="noopener" data-i18n="settings.actions.server">Serwer</a>
      <button class="btn sm tab-btn active" id="btnTabMaintenance" type="button" data-i18n="settings.tabs.maintenance">Prace techniczne</button>
      <button class="btn sm tab-btn" id="btnTabMail" type="button" data-i18n="settings.tabs.mail">Maile</button>
      <div class="ui-select" id="toolsSelect">
        <button class="btn sm ui-select-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
          <span class="ui-select-label" data-i18n="settings.tabs.tools">Narzƒôdzia</span>
          <span class="ui-select-caret" aria-hidden="true">‚ñæ</span>
        </button>
        <div class="ui-select-menu" role="listbox"></div>
      </div>
    </div>
    <div class="topbar-section topbar-section-3"></div>
    <div class="topbar-section topbar-section-4">
      <button class="btn sm" id="btnLogout" type="button" data-i18n="settings.actions.logout">Wyloguj Access</button>
    </div>
  </header>

  <main class="wrap">
    <section class="settings-panel" id="panelScreen" hidden>
      <div class="maintenance-panel">
        <div class="panel-head">
          <div class="panel-title" data-i18n="settings.maintenance.title">Prace techniczne</div>
          <div class="panel-sub" data-i18n="settings.maintenance.subtitle">Ustawienia strony maintenance</div>
        </div>

        <div class="maintenance-controls" id="maintenanceControls">
          <div class="mode-slider" id="modeSliderWrap">
            <input class="mode-range" id="modeSlider" type="range" min="0" max="2" step="1" value="0" aria-label="Maintenance mode"/>
            <div class="mode-labels" id="modeLabels">
              <span class="mode-label" data-mode="message" data-i18n="settings.modes.message">Wiadomo≈õƒá</span>
              <span class="mode-label" data-mode="returnAt" data-i18n="settings.modes.returnAt">Do godziny</span>
              <span class="mode-label" data-mode="countdown" data-i18n="settings.modes.countdown">Odliczanie</span>
            </div>
          </div>

          <div class="mode-block" id="modeMessage">
            <div class="mode-hint" data-i18n="settings.modes.messageHint">Komunikat bez daty i bez odliczania.</div>
          </div>

          <div class="mode-block" id="modeReturnAt" hidden>
            <div class="field">
              <span class="field-label field-title" data-i18n="settings.maintenance.returnAt">Powr√≥t</span>
              <div class="dt-group">
                <input class="dt-input" id="returnAtHour" type="number" inputmode="numeric" placeholder="HH" min="0" max="23"/>
                <span class="dt-colon">:</span>
                <input class="dt-input" id="returnAtMinute" type="number" inputmode="numeric" placeholder="MM" min="0" max="59"/>
                <span class="dt-sep">‚Äî</span>
                <input class="dt-input" id="returnAtDay" type="number" inputmode="numeric" placeholder="DD" min="1" max="31"/>
                <span class="dt-dot">.</span>
                <input class="dt-input" id="returnAtMonth" type="number" inputmode="numeric" placeholder="MM" min="1" max="12"/>
                <span class="dt-dot">.</span>
                <input class="dt-input" id="returnAtYear" type="number" inputmode="numeric" placeholder="YYYY" min="2024" max="2035"/>
                <button class="btn sm dt-open" data-dt-open="returnAt" type="button">üìÖ</button>
              </div>
              <span class="field-hint" data-i18n="settings.maintenance.returnAtHint">Minimum 10 minut od teraz.</span>
            </div>
          </div>

          <div class="mode-block" id="modeCountdown" hidden>
            <div class="field">
              <span class="field-label field-title" data-i18n="settings.modes.endAt">Do godziny</span>
              <div class="dt-group">
                <input class="dt-input" id="endAtHour" type="number" inputmode="numeric" placeholder="HH" min="0" max="23"/>
                <span class="dt-colon">:</span>
                <input class="dt-input" id="endAtMinute" type="number" inputmode="numeric" placeholder="MM" min="0" max="59"/>
                <span class="dt-sep">‚Äî</span>
                <input class="dt-input" id="endAtDay" type="number" inputmode="numeric" placeholder="DD" min="1" max="31"/>
                <span class="dt-dot">.</span>
                <input class="dt-input" id="endAtMonth" type="number" inputmode="numeric" placeholder="MM" min="1" max="12"/>
                <span class="dt-dot">.</span>
                <input class="dt-input" id="endAtYear" type="number" inputmode="numeric" placeholder="YYYY" min="2024" max="2035"/>
                <button class="btn sm dt-open" data-dt-open="endAt" type="button">üìÖ</button>
              </div>
              <span class="field-hint" data-i18n="settings.maintenance.returnAtHint">Minimum 10 minut od teraz.</span>
            </div>
          </div>

          <div class="mode-status" id="modeStatus" hidden>
            <span class="mode-status-label" data-i18n="settings.preview.label">PodglƒÖd:</span>
            <span class="mode-status-value" id="modeStatusValue">‚Äî</span>
          </div>
        </div>

        <div class="warn" id="timeWarn" data-i18n="settings.validation.tooSoonText" hidden>Minimalny czas to 10 minut od teraz.</div>

        <div class="panel-actions">
          <button class="btn sm gold" id="btnStartStop" type="button" data-i18n="settings.actions.start">Start</button>
          <button class="btn sm" id="btnRefresh" type="button" data-i18n="settings.actions.refresh">Od≈õwie≈º</button>
        </div>

        <div class="panel-status" id="panelStatus">
          <span class="status-label" data-i18n="settings.status.label">Status</span>
          <span class="status-value" id="statusValue">‚Äî</span>
        </div>

        <div class="bypass-box">
          <div class="bypass-title" data-i18n="settings.bypass.title">Pomi≈Ñ administratora</div>
          <div class="bypass-actions">
            <label class="toggle" for="bypassToggle">
              <input type="checkbox" id="bypassToggle"/>
              <span class="toggle-ui"></span>
              <span class="toggle-label" data-i18n="settings.bypass.label">W≈ÇƒÖcz bypass</span>
            </label>
          </div>
          <div class="bypass-desc" data-i18n="settings.bypass.desc">Ustawia cookie admina na 30 dni. Dzia≈Ça tylko w tej przeglƒÖdarce.</div>
        </div>
      </div>

      <div class="mail-panel" id="mailPanel" hidden>
        <div class="panel-head">
          <div class="panel-title" data-i18n="settings.mail.title">Maile</div>
          <div class="panel-sub" data-i18n="settings.mail.subtitle">Kolejka, logi i konfiguracja workera</div>
        </div>

        <div class="mail-cards">
          <section class="mail-card mail-card-settings">
            <div class="mail-card-title" data-i18n="settings.mail.settingsTitle">Ustawienia wysy≈Çki</div>
            <div class="field row">
              <label class="toggle" for="mailQueueEnabled">
                <input type="checkbox" id="mailQueueEnabled" checked/>
                <span class="toggle-ui"></span>
                <span class="toggle-label" data-i18n="settings.mail.queueEnabled">Kolejkuj wysy≈Çkƒô (send-mail -> mail_queue)</span>
              </label>
            </div>

            <div class="field">
              <span class="field-label" data-i18n="settings.mail.providerOrder">Kolejno≈õƒá provider√≥w</span>
              <div class="provider-order-list" id="mailProviderOrderList"></div>
            </div>

            <div class="mail-inline-grid">
              <div class="field">
                <label class="field-label" for="mailDelayMs" data-i18n="settings.mail.delayMs">Zw≈Çoka miƒôdzy wysy≈Çkami (ms)</label>
                <input id="mailDelayMs" type="number" min="0" max="5000" step="10" value="250"/>
              </div>
              <div class="field">
                <label class="field-label" for="mailBatchMax" data-i18n="settings.mail.batchMax">Maksymalna partia</label>
                <input id="mailBatchMax" type="number" min="1" max="500" step="1" value="100"/>
              </div>
              <div class="field">
                <label class="field-label" for="mailWorkerLimit" data-i18n="settings.mail.workerLimit">Limit workera (domy≈õlny)</label>
                <input id="mailWorkerLimit" type="number" min="1" max="200" step="1" value="25"/>
                <div class="field-hint" data-i18n="settings.mail.workerLimitHint">Ile maili worker wysy≈Ça podczas jednego uruchomienia.</div>
              </div>
            </div>

            <div class="mail-inline-grid">
              <div class="field">
                <label class="field-label" for="mailCronPresetSelect" data-i18n="settings.mail.cronEvery">Co jaki czas uruchamiaƒá worker</label>
                <div class="ui-select mail-ui-select mail-cron-select" id="mailCronPresetSelect">
                  <button class="btn sm ui-select-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
                    <span class="ui-select-label">‚Äî</span>
                    <span class="ui-select-caret" aria-hidden="true">‚ñæ</span>
                  </button>
                  <div class="ui-select-menu" role="listbox"></div>
                </div>
                <div class="field-hint" id="mailCronHint"></div>
              </div>
              <div class="field row">
                <label class="toggle" for="mailCronActive">
                  <input type="checkbox" id="mailCronActive" checked/>
                  <span class="toggle-ui"></span>
                  <span class="toggle-label" data-i18n="settings.mail.cronActive">Cron aktywny</span>
                </label>
              </div>
            </div>

            <div class="panel-actions">
              <button class="btn sm gold" id="btnMailSaveSettings" type="button" data-i18n="settings.mail.save">Zapisz ustawienia maili</button>
              <button class="btn sm" id="btnMailReloadSettings" type="button" data-i18n="settings.actions.refresh">Od≈õwie≈º</button>
            </div>
            <div class="panel-status">
              <span class="status-label" data-i18n="settings.mail.currentCron">Cron</span>
              <span class="status-value" id="mailSettingsStatus">‚Äî</span>
            </div>
          </section>

          <section class="mail-card mail-card-worker">
            <div class="mail-card-title" data-i18n="settings.mail.workerActions">Rƒôczne akcje workera</div>
            <div class="mail-inline-grid">
              <div class="field">
                <label class="field-label" for="mailRunLimit" data-i18n="settings.mail.runLimit">Limit dla uruchomienia rƒôcznego</label>
                <input id="mailRunLimit" type="number" min="1" max="200" step="1" value="25"/>
                <div class="field-hint" data-i18n="settings.mail.runLimitHint">Maksymalnie tyle rekord√≥w wy≈õle jedno rƒôczne uruchomienie.</div>
              </div>
            </div>
            <div class="panel-actions">
              <button class="btn sm gold" id="btnMailRunWorker" type="button" data-i18n="settings.mail.runWorker">Uruchom worker</button>
              <button class="btn sm" id="btnMailRetryFailed" type="button" data-i18n="settings.mail.retryFailed">Requeue failed + uruchom</button>
              <button class="btn sm" id="btnMailRetrySelected" type="button" data-i18n="settings.mail.retrySelected">Requeue zaznaczone + uruchom</button>
            </div>
            <div class="field-hint" data-i18n="settings.mail.workerHint">Opcje rƒôczne dzia≈ÇajƒÖ na `mail_queue` i uruchamiajƒÖ `invoke_mail_worker(...)`.</div>
          </section>

          <section class="mail-card mail-card-wide mail-card-queue">
            <div class="mail-card-head">
              <div class="mail-card-title" data-i18n="settings.mail.queueTitle">Kolejka wysy≈Çki (mail_queue)</div>
              <div class="mail-controls">
                <div class="ui-select mail-ui-select" id="mailQueueStatusSelect">
                  <button class="btn sm ui-select-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
                    <span class="ui-select-label">‚Äî</span>
                    <span class="ui-select-caret" aria-hidden="true">‚ñæ</span>
                  </button>
                  <div class="ui-select-menu" role="listbox"></div>
                </div>
                <input id="mailQueueLimit" type="number" min="1" max="500" step="10" value="150"/>
                <button class="btn sm" id="btnMailQueueRefresh" type="button" data-i18n="settings.actions.refresh">Od≈õwie≈º</button>
              </div>
            </div>
            <div class="mail-table-wrap">
              <table class="mail-table">
                <thead>
                  <tr>
                    <th></th>
                    <th data-i18n="settings.mail.col.status">Status</th>
                    <th data-i18n="settings.mail.col.to">Do</th>
                    <th data-i18n="settings.mail.col.subject">Temat</th>
                    <th data-i18n="settings.mail.col.attempts">Pr√≥by</th>
                    <th data-i18n="settings.mail.col.lastError">B≈ÇƒÖd</th>
                    <th data-i18n="settings.mail.col.createdAt">Utworzono</th>
                    <th data-i18n="settings.mail.col.action">Akcja</th>
                  </tr>
                </thead>
                <tbody id="mailQueueBody"></tbody>
              </table>
            </div>
            <div class="field-hint" id="mailQueueInfo">‚Äî</div>
          </section>

          <section class="mail-card mail-card-wide mail-card-logs">
            <div class="mail-card-head">
              <div class="mail-card-title" data-i18n="settings.mail.logsTitle">Logi funkcji mailowych</div>
              <div class="mail-controls">
                <div class="ui-select mail-ui-select" id="mailLogFnSelect">
                  <button class="btn sm ui-select-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
                    <span class="ui-select-label">‚Äî</span>
                    <span class="ui-select-caret" aria-hidden="true">‚ñæ</span>
                  </button>
                  <div class="ui-select-menu" role="listbox"></div>
                </div>
                <div class="ui-select mail-ui-select" id="mailLogLevelSelect">
                  <button class="btn sm ui-select-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
                    <span class="ui-select-label">‚Äî</span>
                    <span class="ui-select-caret" aria-hidden="true">‚ñæ</span>
                  </button>
                  <div class="ui-select-menu" role="listbox"></div>
                </div>
                <input id="mailLogLimit" type="number" min="1" max="500" step="10" value="200"/>
                <button class="btn sm" id="btnMailLogsHelp" type="button" data-i18n="settings.mail.logsHelpBtn">Jak czytaƒá logi</button>
                <button class="btn sm" id="btnMailLogsRefresh" type="button" data-i18n="settings.actions.refresh">Od≈õwie≈º</button>
              </div>
            </div>
            <div class="mail-help" id="mailLogsHelp" hidden>
              <div class="mail-help-title" data-i18n="settings.mail.logsHelpTitle">Jak czytaƒá logi</div>
              <p class="mail-help-lead" data-i18n="settings.mail.logsHelpLead">Ka≈ºdy wiersz to jedno zdarzenie z funkcji send-mail / send-email / mail-worker.</p>
              <ul class="mail-help-list">
                <li data-i18n="settings.mail.logsHelp.levels">`level`: info = normalny przebieg, warn = czƒô≈õciowy problem, error = b≈ÇƒÖd wysy≈Çki.</li>
                <li data-i18n="settings.mail.logsHelp.events">`event`: np. `queue_picked`, `queue_item_sent`, `queue_item_failed` pokazuje etap przetwarzania.</li>
                <li data-i18n="settings.mail.logsHelp.recipient">`Do` i `Provider` m√≥wiƒÖ dla kogo i przez jakiego dostawcƒô sz≈Ça pr√≥ba wysy≈Çki.</li>
                <li data-i18n="settings.mail.logsHelp.error">Kolumna `B≈ÇƒÖd` zawiera konkretny pow√≥d niepowodzenia (API key, timeout, 4xx/5xx provider√≥w itp.).</li>
                <li data-i18n="settings.mail.logsHelp.next">Je≈õli widzisz `queue_item_failed`, sprawd≈∫ b≈ÇƒÖd, popraw konfiguracjƒô i u≈ºyj ‚ÄûWy≈õlij teraz‚Äù lub ‚ÄûWy≈õlij zaznaczone‚Äù.</li>
              </ul>
            </div>
            <div class="mail-table-wrap">
              <table class="mail-table">
                <thead>
                  <tr>
                    <th data-i18n="settings.mail.col.time">Czas</th>
                    <th data-i18n="settings.mail.col.function">Funkcja</th>
                    <th data-i18n="settings.mail.col.level">Poziom</th>
                    <th data-i18n="settings.mail.col.event">Event</th>
                    <th data-i18n="settings.mail.col.to">Do</th>
                    <th data-i18n="settings.mail.col.provider">Provider</th>
                    <th data-i18n="settings.mail.col.lastError">B≈ÇƒÖd</th>
                  </tr>
                </thead>
                <tbody id="mailLogsBody"></tbody>
              </table>
            </div>
            <div class="field-hint" id="mailLogsInfo">‚Äî</div>
          </section>
        </div>
      </div>
    </section>

  </main>

  <section class="tools-shell" id="toolsShell" hidden>
    <div class="tools-frame-wrap">
      <iframe id="toolsFrame" title="Tools" loading="lazy"></iframe>
    </div>
  </section>

  <footer class="footer wrap">
    <span data-i18n="settings.footerLeft">Familiada ‚Äî panel admina</span>
    <span data-i18n="settings.footerRight">Dostƒôp tylko dla uprawnionych.</span>
  </footer>

  <div class="settings-auth" id="authScreen">
    <div class="auth-card" id="authCard">
      <div class="auth-brand">FAMILIADA</div>
      <div class="auth-sub" data-i18n="settings.login.title">Panel ustawie≈Ñ</div>
      <div class="status" id="authStatus" data-i18n="settings.login.checking">Trwa weryfikacja‚Ä¶</div>

      <div class="auth-form">
        <button class="btn sm gold" id="btnAccessLogin" type="button" data-i18n="settings.login.loginBtn">Zaloguj przez Access</button>
      </div>

      <div class="hint" id="loginHint" data-i18n="settings.login.hint">Ten panel wymaga autoryzacji Cloudflare Access.</div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="dt-modal" id="dtModal" hidden>
    <div class="dt-card">
      <div class="dt-head">
        <button class="btn sm" id="dtToday" type="button" data-i18n="settings.actions.today">Dzi≈õ</button>
        <button class="btn sm" id="dtPrev" type="button">‚óÄ</button>
        <div class="dt-title" id="dtTitle">‚Äî</div>
        <button class="btn sm" id="dtNext" type="button">‚ñ∂</button>
      </div>
      <div class="dt-grid" id="dtGrid"></div>
      <div class="dt-time">
        <div class="dt-time-label" id="dtTimeLabel" data-i18n="settings.actions.time">Czas</div>
        <div class="dt-time-row">
          <div class="dt-wheel" id="dtHourWheel"></div>
          <span class="dt-colon">:</span>
          <div class="dt-wheel" id="dtMinuteWheel"></div>
        </div>
      </div>
      <div class="dt-actions">
        <button class="btn sm" id="dtCancel" type="button" data-i18n="settings.actions.cancel">Anuluj</button>
        <button class="btn sm gold" id="dtOk" type="button" data-i18n="settings.actions.ok">OK</button>
      </div>
    </div>
  </div>
</body>
</html>
