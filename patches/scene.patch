--- a/familiada/display/js/scene.js
+++ b/familiada/display/js/scene.js
@@ -1,6 +1,6 @@
 import { loadJson, buildGlyphMap, resolveGlyph } from "./fonts.js";
 import { createAnimator } from "./anim.js";
 import { sb } from "../../js/core/supabase.js";

 export async function createScene() {
   const NS = "http://www.w3.org/2000/svg";
   const $  = (id) => document.getElementById(id);
@@ -14,6 +14,176 @@
 
   const VIEW = { W: 1600, H: 900, CX: 800, CY: 450 };

+  // ============================================================
+  // THEME: 3 kolory bazowe -> reszta pochodne
+  // ============================================================
+  const clamp01 = (v) => Math.max(0, Math.min(1, v));
+
+  // Akceptuje: "#rgb", "#rrggbb", "dodgerblue", "red", itd.
+  // Zwraca {r,g,b} albo null
+  const cssColorToRgb = (css) => {
+    const s = (css ?? "").toString().trim();
+    if (!s) return null;
+    const tmp = document.createElement("div");
+    tmp.style.color = "";
+    tmp.style.color = s;
+    if (!tmp.style.color) return null; // przeglÄ…darka nie rozpoznaÅ‚a
+    document.body.appendChild(tmp);
+    const rgb = getComputedStyle(tmp).color; // "rgb(r,g,b)" / "rgba"
+    tmp.remove();
+    const m = rgb.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
+    if (!m) return null;
+    return { r: +m[1], g: +m[2], b: +m[3] };
+  };
+
+  const rgbToHex = ({ r, g, b }) => {
+    const h = (n) => (n|0).toString(16).padStart(2, "0");
+    return `#${h(r)}${h(g)}${h(b)}`.toLowerCase();
+  };
+
+  const mix = (c1, c2, t) => {
+    t = clamp01(t);
+    return {
+      r: Math.round(c1.r + (c2.r - c1.r) * t),
+      g: Math.round(c1.g + (c2.g - c1.g) * t),
+      b: Math.round(c1.b + (c2.b - c1.b) * t),
+    };
+  };
+
+  const lighten = (c, t) => mix(c, { r:255, g:255, b:255 }, t);
+  const darken  = (c, t) => mix(c, { r:0,   g:0,   b:0   }, t);
+
+  // 3 bazowe (domyÅ›lne)
+  const THEME = {
+    base: {
+      A:  "#c4002f",
+      B:  "#2a62ff",
+      BG: "#0b0b10",
+    },
+    derived: {
+      A_dark: "",
+      B_dark: "",
+      A_lamp: "",
+      B_lamp: "",
+      B_glow: "",
+      bgGradient: "",
+    },
+  };
+
+  const computeDerived = () => {
+    const A = cssColorToRgb(THEME.base.A)  ?? { r:196, g:0,   b:47  };
+    const B = cssColorToRgb(THEME.base.B)  ?? { r:42,  g:98,  b:255 };
+    const G = cssColorToRgb(THEME.base.BG) ?? { r:11,  g:11,  b:16  };
+
+    // pochodne â€œciemniejszeâ€ do gradientu obwÃ³dki
+    THEME.derived.A_dark = rgbToHex(darken(A, 0.38));
+    THEME.derived.B_dark = rgbToHex(darken(B, 0.35));
+
+    // lampki: jaÅ›niejsze od bazowych
+    THEME.derived.A_lamp = rgbToHex(lighten(A, 0.25));
+    THEME.derived.B_lamp = rgbToHex(lighten(B, 0.18));
+
+    // neon: glow pochodny od B
+    THEME.derived.B_glow = rgbToHex(lighten(B, 0.28));
+
+    // tÅ‚o: tylko BG + delikatny akcent A/B (bez fioletu)
+    const bg0 = lighten(G, 0.10);
+    const bg1 = mix(G, darken(G, 0.75), 0.55);
+    const aAcc = mix(bg0, A, 0.18);
+    const bAcc = mix(bg0, B, 0.16);
+
+    THEME.derived.bgGradient =
+      `radial-gradient(1400px 700px at 50% 25%, ` +
+      `${rgbToHex(mix(aAcc, bAcc, 0.50))} 0%, ` +
+      `${rgbToHex(bg0)} 30%, ` +
+      `${rgbToHex(bg1)} 70%, ` +
+      `${rgbToHex(darken(G, 0.85))} 100%)`;
+  };
+
+  // Referencje do elementÃ³w, ktÃ³re chcemy â€œtematyzowaÄ‡â€
+  let basebarOutlineA = null;
+  let basebarOutlineB = null;
+
+  // Lampy (po utworzeniu)
+  let lampA = null;
+  let lampB = null;
+
+  const applyTheme = () => {
+    computeDerived();
+
+    // CSS vars (tÅ‚o i ew. uÅ¼ycie pÃ³Åºniej)
+    document.documentElement.style.setProperty("--teamA", THEME.base.A);
+    document.documentElement.style.setProperty("--teamB", THEME.base.B);
+    document.documentElement.style.setProperty("--bg",    THEME.base.BG);
+    document.documentElement.style.setProperty("--bg-gradient", THEME.derived.bgGradient);
+
+    // rim gradient stops
+    const rimA  = $("rimStopA");
+    const rimA2 = $("rimStopA2");
+    const rimB2 = $("rimStopB2");
+    const rimB  = $("rimStopB");
+    if (rimA)  rimA.setAttribute("stop-color", THEME.base.A);
+    if (rimA2) rimA2.setAttribute("stop-color", THEME.derived.A_dark);
+    if (rimB2) rimB2.setAttribute("stop-color", THEME.derived.B_dark);
+    if (rimB)  rimB.setAttribute("stop-color", THEME.base.B);
+
+    // neon filter (glow)
+    const ds1 = $("neonDS1");
+    const ds2 = $("neonDS2");
+    if (ds1) ds1.setAttribute("flood-color", THEME.derived.B_glow);
+    if (ds2) ds2.setAttribute("flood-color", THEME.derived.B_glow);
+
+    // basebar outlines
+    if (basebarOutlineA) basebarOutlineA.setAttribute("stroke", THEME.base.A);
+    if (basebarOutlineB) basebarOutlineB.setAttribute("stroke", THEME.base.B);
+
+    // lamp colors (jeÅ›li juÅ¼ istniejÄ…)
+    if (lampA?.setColor) lampA.setColor(THEME.derived.A_lamp);
+    if (lampB?.setColor) lampB.setColor(THEME.derived.B_lamp);
+  };
+
+  const setBaseColor = (which, value) => {
+    const w = (which ?? "").toString().toUpperCase();
+    const val = (value ?? "").toString().trim();
+    if (!val) throw new Error("COLOR: brak wartoÅ›ci koloru");
+    if (!cssColorToRgb(val)) throw new Error(`COLOR: nieprawidÅ‚owy kolor: ${val}`);
+
+    if (w === "A") THEME.base.A = val;
+    else if (w === "B") THEME.base.B = val;
+    else if (w === "BACKGROUND") THEME.base.BG = val;
+    else throw new Error(`COLOR: nieznany cel "${which}" (uÅ¼yj A | B | BACKGROUND)`);
+
+    applyTheme();
+  };
+
   // WyglÄ…d
   const COLORS = {
     big:    "#2e2e32",
     cell:   "#000000",
     dotOff: "#2e2e32",
   };

@@ -520,6 +690,7 @@
   // TÅO paska
   basebar.appendChild(el("rect", {
     x: barX,
     y: barY,
     width: barW,
     height: barH,
     fill: "url(#silverGrad)",
   }));

@@ -536,7 +707,7 @@
   // LEWA poÅ‚Ã³wka â€“ czerwony, ale spokojniejszy
-  basebar.appendChild(el("rect", {
+  basebarOutlineA = el("rect", {
     x: barX,
     y: barY,
     width: halfW,
     height: barH,
     fill: "none",
-    stroke: "#c4002f",
+    stroke: THEME.base.A,
     "stroke-width": outlineW,
     "stroke-opacity": 0.55,
     "stroke-linejoin": "round",
     // bez filtra neonowego â€“ mniej â€žwali po oczachâ€
-  }));
+  });
+  basebar.appendChild(basebarOutlineA);

   // PRAWA poÅ‚Ã³wka â€“ niebieski, teÅ¼ spokojniejszy
-  basebar.appendChild(el("rect", {
+  basebarOutlineB = el("rect", {
     x: barX + halfW,
     y: barY,
     width: halfW,
     height: barH,
     fill: "none",
-    stroke: "#2a62ff",
+    stroke: THEME.base.B,
     "stroke-width": outlineW,
     "stroke-opacity": 0.55,
     "stroke-linejoin": "round",
-  }));
+  });
+  basebar.appendChild(basebarOutlineB);

@@ -620,7 +791,7 @@
   const makeLamp = (parent, cx, cy, r, colorOn) => {
     const svg = parent.ownerSVGElement;

     // unikalne ID gradientu
     const gid = `lampGrad_${Math.random().toString(16).slice(2)}`;
@@ -654,10 +825,12 @@
     const grad = el("radialGradient", {
       id: gid,
       cx: "35%",
       cy: "30%",
       r: "70%"
     });
-    grad.appendChild(el("stop", { offset: "0%",  "stop-color": "#ffffff", "stop-opacity": "0.65" }));
-    grad.appendChild(el("stop", { offset: "25%", "stop-color": colorOn,   "stop-opacity": "1" }));
-    grad.appendChild(el("stop", { offset: "100%","stop-color": "#000000", "stop-opacity": "0.35" }));
+    const stop0 = el("stop", { offset: "0%",   "stop-color": "#ffffff", "stop-opacity": "0.65" });
+    const stop1 = el("stop", { offset: "25%",  "stop-color": colorOn,   "stop-opacity": "1" });
+    const stop2 = el("stop", { offset: "100%", "stop-color": "#000000", "stop-opacity": "0.35" });
+    grad.appendChild(stop0); grad.appendChild(stop1); grad.appendChild(stop2);
     defs.appendChild(grad);

@@ -690,7 +863,7 @@
     const glow = el("circle", {
       cx, cy, r: r * 1.08,
       fill: colorOn,
       opacity: "0",
       filter: "url(#neonBlue)"
     });

@@ -720,7 +893,22 @@
     const setOn = (on) => {
       // OFF: ciemno, ale widaÄ‡ szkÅ‚o
       offBody.setAttribute("opacity", on ? "0.20" : "0.95");
       // ON: gÅ‚Ã³wna kula
       onBody.setAttribute("opacity", on ? "0.98" : "0");
       // glow
       glow.setAttribute("opacity", on ? "0.85" : "0");
       // highlight trochÄ™ mocniejszy gdy Å›wieci (efekt szkÅ‚a)
       highlight.setAttribute("opacity", on ? "0.28" : "0.14");
     };
+
+    // NOWE: zmiana koloru lampki â€œw locieâ€
+    const setColor = (newColor) => {
+      const c = (newColor ?? "").toString().trim();
+      if (!c) return;
+      stop1.setAttribute("stop-color", c);
+      glow.setAttribute("fill", c);
+    };

-    return { setOn, node: gLamp };
+    return { setOn, setColor, node: gLamp };
   };

@@ -735,10 +923,12 @@
   const lampAX = barX + padX;        // A po lewej
   const lampBX = barX + barW - padX; // B po prawej

-  const lampA = makeLamp(basebar, lampAX, lampsY, lampR, "#ff2e3b");
-  const lampB = makeLamp(basebar, lampBX, lampsY, lampR, "#2a62ff");
+  // Lampy biorÄ… kolor z THEME (pochodne)
+  computeDerived();
+  lampA = makeLamp(basebar, lampAX, lampsY, lampR, THEME.derived.A_lamp);
+  lampB = makeLamp(basebar, lampBX, lampsY, lampR, THEME.derived.B_lamp);

   lampA.setOn(false);
   lampB.setOn(false);

@@ -770,6 +960,11 @@
   let indicatorState = "OFF";

+  // Po zbudowaniu kluczowych elementÃ³w (basebar/lamps) nakÅ‚adamy theme na caÅ‚oÅ›Ä‡
+  // (ustawi rimGrad/neon/tÅ‚o/obrysy/lampy)
+  applyTheme();
+
   // ============================================================
   // LOGO â€“ 2 typy:
   // - GLYPH_30x10: 10 wierszy po 30 znakÃ³w
   // - PIX_150x70: bitmapa 150x70 (pod BIG 30x10 * 5x7)
   // ============================================================

@@ -1190,6 +1385,33 @@
   const handleCommand = async (line) => {
     const raw = (line ?? "").toString().trim();
     if (!raw) return;

     const tokens = tokenize(raw);
     const head = (tokens[0] ?? "").toUpperCase();

+    // ============================================================
+    // COLOR A <hex|name>
+    // COLOR B <hex|name>
+    // COLOR BACKGROUND <hex|name>
+    // (nazwa moÅ¼e byÄ‡ w cudzysÅ‚owie: "light blue")
+    // ============================================================
+    if (head === "COLOR") {
+      const target = (tokens[1] ?? "").toUpperCase();
+      const val = unquote(tokens.slice(2).join(" "));
+      try {
+        setBaseColor(target, val);
+        console.log(`[COLOR] ${target} = ${val}`);
+      } catch (e) {
+        console.warn(String(e?.message || e));
+      }
+      return;
+    }
+
     // ðŸ”§ DEBUG
     // ...
