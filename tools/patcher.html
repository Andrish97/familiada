<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wklej plik + patch → wynik</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 16px; line-height: 1.3; }
    textarea { width: 100%; min-height: 200px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    .btns { display: flex; gap: 8px; flex-wrap: wrap; }
    button { padding: 10px 12px; cursor: pointer; }
    .ok { color: #0a0; font-weight: 600; }
    .err { color: #a00; font-weight: 600; }
    details { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Patch w przeglądarce (kopiuj/wklej)</h2>

  <div class="row">
    <label>
      <div><strong>1) Wklej aktualną treść pliku</strong></div>
      <textarea id="original" placeholder="Tu wklej zawartość pliku (np. CSS/JS/HTML/JSON)"></textarea>
    </label>

    <label>
      <div><strong>2) Wklej patch/diff (unified diff)</strong></div>
      <textarea id="patch" placeholder="Tu wklej diff zaczynający się np. od --- a/... +++ b/..."></textarea>
    </label>

    <div class="btns">
      <button id="applyBtn">Zastosuj patch</button>
      <button id="copyBtn" disabled>Skopiuj wynik</button>
      <button id="clearBtn">Wyczyść</button>
    </div>

    <div id="status"></div>

    <label>
      <div><strong>3) Wynik (skopiuj i wklej do pliku)</strong></div>
      <textarea id="result" placeholder="Tu pojawi się wynik..." readonly></textarea>
    </label>

    <details>
      <summary>Wskazówki (gdy nie działa)</summary>
      <ul>
        <li>Patch musi być „unified diff”: linie <code>@@ ... @@</code> i bloki z <code>+</code>/<code>-</code>.</li>
        <li>Ten prosty patcher działa najlepiej, gdy diff dotyczy <strong>jednego pliku</strong>.</li>
        <li>Jeśli w patchu masz <code>--- a/styles.css</code> a plik w repo nazywa się inaczej, to <em>nie szkodzi</em> — tu i tak aplikujemy do wklejonej treści.</li>
      </ul>
    </details>
  </div>

  <!-- jsdiff (działa z CDN). Jeśli chcesz 100% offline, mogę dać wersję bez CDN. -->
  <script src="https://cdn.jsdelivr.net/npm/diff@5.2.0/dist/diff.min.js"></script>
  <script>
    const $ = (id) => document.getElementById(id);
    const statusEl = $("status");
    const copyBtn = $("copyBtn");

    function setStatus(msg, ok=true) {
      statusEl.className = ok ? "ok" : "err";
      statusEl.textContent = msg;
    }

    $("applyBtn").addEventListener("click", () => {
      const original = $("original").value.replace(/\r\n/g, "\n");
      const patch = $("patch").value.replace(/\r\n/g, "\n");

      $("result").value = "";
      copyBtn.disabled = true;

      if (!original.trim()) return setStatus("Wklej treść pliku.", false);
      if (!patch.trim()) return setStatus("Wklej patch/diff.", false);

      try {
        // applyPatch expects a unified diff for a single file.
        const out = Diff.applyPatch(original, patch);

        if (out === false) {
          setStatus("Nie udało się zastosować patcha (kontekst nie pasuje). Sprawdź czy to diff do tej wersji pliku.", false);
          return;
        }

        $("result").value = out;
        copyBtn.disabled = false;
        setStatus("OK — patch zastosowany. Skopiuj wynik.", true);
      } catch (e) {
        setStatus("Błąd: " + (e && e.message ? e.message : String(e)), false);
      }
    });

    copyBtn.addEventListener("click", async () => {
      const text = $("result").value;
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        setStatus("Skopiowano do schowka.", true);
      } catch {
        // fallback
        $("result").focus();
        $("result").select();
        document.execCommand("copy");
        setStatus("Skopiowano (fallback).", true);
      }
    });

    $("clearBtn").addEventListener("click", () => {
      $("original").value = "";
      $("patch").value = "";
      $("result").value = "";
      copyBtn.disabled = true;
      setStatus("");
      statusEl.className = "";
    });
  </script>
</body>
</html>
