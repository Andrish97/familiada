<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Familiada — centrum sondaży</title>

  <link rel="icon" href="favicon.ico"/>
  <link rel="stylesheet" href="css/base.css"/>
  <link rel="stylesheet" href="css/builder.css"/>
  <link rel="stylesheet" href="css/polls-hub.css"/>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
  <script type="module" src="js/pages/polls-hub.js" defer></script>
</head>

<body class="builder-body">

  <div class="wrap">

    <!-- BAR jak w builder -->
    <div class="bar">
      <div>
        <div class="title">CENTRUM SONDAŻY</div>
        <div class="hint" id="hubMsg">—</div>
      </div>

      <div class="actions">
        <button class="btn" id="btnBack" type="button">← Moje gry</button>
        <span class="hint" style="margin:0" id="who">—</span>
        <button class="btn" id="btnLogout" type="button">Wyloguj</button>
      </div>
    </div>

    <!-- KARTA 1 -->
    <section class="builder-card card hubCard">
      <div class="hubCardHead">
        <div class="hubCardTitle">Sondaże</div>
      </div>

      <div class="hubSplit">

        <!-- Moje sondaże -->
        <div class="hubCol" data-title="Moje sondaże">
          <div class="hubColHead">
            <div>
              <div class="hubColTitle">Moje sondaże</div>
              <div class="hubColHint" id="pollSelectionHint">Wybierz sondaż z listy.</div>
            </div>
            <div class="hubColActions">
              <button class="btn sm" id="btnShare" type="button" disabled>Udostępnij</button>
              <button class="btn sm" id="btnDetails" type="button" disabled>Szczegóły</button>
            </div>
          </div>

          <div class="hubFilters">
            <select class="inp sm" id="selPollSort">
              <option value="default">• Domyślne</option>
              <option value="new">• Najnowsze</option>
              <option value="old">• Najstarsze</option>
              <option value="az">• Nazwa A–Z</option>
              <option value="za">• Nazwa Z–A</option>
            </select>

            <label class="hubToggle">
              <input type="checkbox" id="chkPollArchive">
              <span>Archiwalne</span>
            </label>
          </div>

          <div class="hubList" id="listMyPolls"></div>
        </div>

        <!-- Zadania -->
        <div class="hubCol" data-title="Zadania">
          <div class="hubColHead">
            <div class="hubColTitle">Zadania</div>
          </div>

          <div class="hubFilters">
            <select class="inp sm" id="selTaskSort">
              <option value="default">• Domyślne</option>
              <option value="new">• Najnowsze</option>
              <option value="old">• Najstarsze</option>
              <option value="az">• Nazwa A–Z</option>
              <option value="za">• Nazwa Z–A</option>
            </select>

            <label class="hubToggle">
              <input type="checkbox" id="chkTaskArchive">
              <span>Archiwalne</span>
            </label>
          </div>

          <div class="hubList" id="listTasks"></div>
        </div>

      </div>
    </section>

    <!-- KARTA 2 -->
    <section class="builder-card card hubCard">
      <div class="hubCardHead">
        <div class="hubCardTitle">Subskrypcje</div>
      </div>

      <div class="hubSplit">

        <!-- Moi subskrybenci -->
        <div class="hubCol" data-title="Moi subskrybenci">
          <div class="hubColHead">
            <div class="hubColTitle">Moi subskrybenci</div>
            <div class="hubColActions">
              <button class="btn sm" id="btnAddSubscriber" type="button">Dodaj</button>
            </div>
          </div>

          <div class="hubFilters">
            <select class="inp sm" id="selMySubsSort">
              <option value="default">• Domyślne</option>
              <option value="new">• Najnowsze</option>
              <option value="old">• Najstarsze</option>
              <option value="az">• Nazwa A–Z</option>
              <option value="za">• Nazwa Z–A</option>
            </select>
          </div>

          <div class="hubList" id="listMySubscribers"></div>
        </div>

        <!-- Moje subskrypcje -->
        <div class="hubCol" data-title="Moje subskrypcje">
          <div class="hubColHead">
            <div class="hubColTitle">Moje subskrypcje</div>
          </div>

          <div class="hubFilters">
            <select class="inp sm" id="selTheirSubsSort">
              <option value="default">• Domyślne</option>
              <option value="new">• Najnowsze</option>
              <option value="old">• Najstarsze</option>
              <option value="az">• Nazwa A–Z</option>
              <option value="za">• Nazwa Z–A</option>
            </select>
          </div>

          <div class="hubList" id="listMySubscriptions"></div>
        </div>

      </div>
    </section>

  </div>

  <!-- MODAL: Dodaj subskrybenta -->
  <div class="overlay" id="ovAddSubscriber" style="display:none;">
    <div class="modal" style="width:min(640px,94vw)">
      <div class="mTitle">Dodaj subskrybenta</div>
      <div class="mSub">Wpisz e-mail albo nazwę użytkownika.</div>

      <div style="display:flex; gap:10px; margin-top:10px;">
        <input class="inp" id="inpSubscriber" placeholder="email lub username" style="flex:1" autocomplete="off">
        <button class="btn" id="btnSendInvite" type="button">Wyślij</button>
      </div>

      <div class="mSub" id="addSubMsg" style="margin-top:10px;">—</div>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:14px;">
        <button class="btn sm" id="btnCloseAddSub" type="button">Zamknij</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Udostępnianie -->
  <div class="overlay" id="ovShare" style="display:none;">
    <div class="modal hubModal">
      <div class="mTitle">Udostępnij sondaż</div>
      <div class="mSub" id="sharePollName">—</div>

      <div class="hubTabs" role="tablist">
        <button class="hubTab active" type="button" data-mode="anon" role="tab">Anonimowy</button>
        <button class="hubTab" type="button" data-mode="subs" role="tab">Subskrybenci</button>
        <button class="hubTab" type="button" data-mode="mixed" role="tab">Mieszany</button>
      </div>

      <div class="hubTabBody active" data-panel="anon">
        <div class="hubAnon">
          <label class="hubField">
            <span>Link do sondażu</span>
            <div class="hubInputRow">
              <input class="inp" id="shareLink" readonly>
              <button class="btn sm" id="btnCopyLink" type="button">Kopiuj</button>
            </div>
          </label>

          <div class="hubActionRow">
            <button class="btn sm" id="btnOpenLink" type="button">Otwórz</button>
            <button class="btn sm" id="btnOpenQr" type="button">Kod QR</button>
            <button class="btn sm" id="btnOpenDisplay" type="button">Wyświetlacz</button>
          </div>
        </div>
      </div>

      <div class="hubTabBody" data-panel="subs">
        <div class="hubSubsHead">
          <div class="hubSubTitle">Wybierz subskrybentów</div>
          <div class="hubSubMeta" id="subsSelectionMeta">0 zaznaczonych</div>
        </div>
        <div class="hubSubsList" id="shareSubsList"></div>
      </div>

      <div class="hubTabBody" data-panel="mixed">
        <div class="hubMixed">
          <div class="hubMixedRow">
            <div class="hubMixedTitle">Anonimowy link</div>
            <input class="inp" id="shareLinkMixed" readonly>
          </div>
          <div class="hubSubsHead">
            <div class="hubSubTitle">Subskrybenci</div>
            <div class="hubSubMeta" id="subsSelectionMetaMixed">0 zaznaczonych</div>
          </div>
          <div class="hubSubsList" id="shareSubsListMixed"></div>
        </div>
      </div>

      <div class="mSub hubModalMsg" id="shareMsg">—</div>

      <div class="hubModalActions">
        <button class="btn sm" id="btnCloseShare" type="button">Zamknij</button>
        <button class="btn" id="btnApplyShare" type="button">Zapisz udostępnienie</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Szczegóły -->
  <div class="overlay" id="ovDetails" style="display:none;">
    <div class="modal hubModal">
      <div class="mTitle">Szczegóły sondażu</div>
      <div class="mSub" id="detailsPollName">—</div>

      <div class="hubDetailsRow">
        <div class="hubDetailsCard">
          <div class="hubDetailsTitle">Głosy subskrybentów</div>
          <div class="hubDetailsList" id="detailsVotesList"></div>
        </div>
        <div class="hubDetailsCard">
          <div class="hubDetailsTitle">Anonimowe głosy</div>
          <div class="hubDetailsAnon" id="detailsAnonCount">—</div>
        </div>
      </div>

      <div class="mSub hubModalMsg" id="detailsMsg">—</div>

      <div class="hubModalActions">
        <button class="btn sm" id="btnCloseDetails" type="button">Zamknij</button>
      </div>
    </div>
  </div>

</body>
</html>
